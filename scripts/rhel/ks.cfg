# Generated by Anaconda 34.25.0.29
# version=RHEL9
text  # Use text mode for faster automated installs
cdrom
firstboot --disable

# KR 2.2: Consistent Partitioning
ignoredisk --only-use=nvme0n1
clearpart --linux --drives=nvme0n1 --initlabel

# Bootloader & Partitioning (Matches your Splunk requirements)
part /boot --fstype="xfs" --ondisk=nvme0n1 --size=1024
part /boot/efi --fstype="efi" --ondisk=nvme0n1 --size=600 --fsoptions="umask=0077,shortname=winnt"
part pv.01 --fstype="lvmpv" --ondisk=nvme0n1 --size=81928
part pv.02 --fstype="lvmpv" --ondisk=nvme0n1 --size=204804

volgroup vg_os pv.01
volgroup vg_data pv.02

logvol / --fstype="xfs" --name=root --vgname=vg_os --size=20480
logvol /home --fstype="xfs" --name=home --vgname=vg_os --size=10240
logvol /var --fstype="xfs" --name=var --vgname=vg_os --size=10240
logvol /var/log --fstype="xfs" --name=log --vgname=vg_os --size=10240
logvol /var/log/audit --fstype="xfs" --name=audit --vgname=vg_os --size=5120
logvol /var/tmp --fstype="xfs" --name=tmp --vgname=vg_os --size=5120
logvol /opt --fstype="xfs" --name=opt --vgname=vg_os --size=20480
logvol /opt/splunk --fstype="xfs" --name=opt_splunk --vgname=vg_data --size=204800

timezone America/New_York --utc
rootpw --iscrypted $6$qIITuNbVy5YxGuZF$rZqqPZEBmvHCGWWwjA1lDAzkPdW53dLOP1TmQ5w4/uZ0SX0exOKODsR0z1Y0pCisKcHH3MUQMN3bbelX/FWjM0

# KR 3.1: Minimal Package Set
%packages
@^server-product-environment
dnf-utils
ipcalc
ansible-core
%end

# Enable SSH for Packer
services --enabled="sshd"

%post --log=/var/log/ks-post.log
